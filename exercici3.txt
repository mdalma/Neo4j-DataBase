#Exercici 3a

CALL gds.graph.create('Ex3_a2',['Individual', 'Habitatge'], 'VIU')

CALL gds.wcc.stream({nodeProjection:['Individual','Habitatge'], relationshipProjection: ['VIU']})
YIELD nodeId, componentId
WITH componentId, collect(nodeId) as nodes, size(collect(nodeId)) as mida 
ORDER BY mida DESC
MATCH (n)
WHERE id(n) in nodes 
RETURN mida as mida_component, count(n) as nombre_components


MATCH (p:Individual)-[:SAME_AS]-(q:Individual)
WITH p {.name, .surname} as Nom, p.id as ID
RETURN ID as `Person ID`, size(collect(Nom)) as Num, collect(Nom) as Noms
ORDER BY Num DESC


# Execici 3b

MATCH (h:Habitatge),(h2:Habitatge)
WHERE h.id_llar <> h2.id_llar 
    AND h.numero=h2.numero 
    AND h.municipi=h2.municipi 
    AND h.carrer=h2.carrer
MERGE (h)-[:MATEIX_HAB]->(h2)

CALL gds.graph.create('Ex3_b',['Individual','Habitatge'],['VIU','FAMILIA','MATEIX_HAB'])

CALL gds.nodeSimilarity.write('Ex3_b',{
  writeRelationshipType:'MATEIX_HAB',
  writeProperty:'score',
  similarityCutoff:0.45,
  topK:5
  writeProperty:'score'
  })
YIELD nodesCompared, relationshipsWritten
