# Exercici 2

# Exercici 1 (OK)
MATCH (ind:Individual)-[:VIU]->(p:Habitatge)
WHERE p.municipi = 'CR' and ind.surname<>'nan'
RETURN count(ind.surname) as `Número Habitants`, collect(DISTINCT ind.surname) as `Llista noms`

# Exercici 2 (OK)
MATCH (h:Habitatge)<-[:VIU]-(p:Individual)
WHERE h.any_padro < 1840 AND h.municipi = 'SFLL'
RETURN DISTINCT h.any_padro as `Any del padró`, collect(distinct(h.id_llar)) as `id de la llar`
ORDER BY h.any_padro

# Exercici 3 (crec que ok)
a) En forma de graf
MATCH (i1:Individual{name:"rafel",surname:"marti"})-[:VIU]->(h:Habitatge)<-[:VIU]-(i2:Individual), (i1)-[:FAMILIA]->(i2)
WHERE h.any_padro=1838 AND h.municipi="SFLL"
RETURN i1,i2
b) En forma de llista
MATCH (i1:Individual{name:"rafel",surname:"marti"})-[:VIU]->(h:Habitatge)<-[:VIU]-(i2:Individual), (i1)-[:FAMILIA]->(i2)
WHERE h.any_padro=1838 AND h.municipi="SFLL"
RETURN collect(i2.name)

# Exercici 4 (OK)
MATCH path= ((i:Individual{name:'miguel', surname:'ballester'})-[:SAME_AS]-(i2:Individual)) 
RETURN path

# Exercici 5 (OK)
MATCH (ind1:Individual)-[rel]-(ind2:Individual)
WHERE toLower(ind1.name) = 'antonio' AND toLower(ind1.surname) = 'farran'
RETURN distinct ind2.name as `Nom`, ind2.surname as `Cognom1`, ind2.second_surname as `Cognom2`, type(rel) as `Tipus`
ORDER BY ind2.name

#Exercici 6 (OK)
MATCH(p:Individual)-[r:FAMILIA]-> (:Individual) 
RETURN collect(distinct(r.relacio)) as `tipus de relacions`

#Exercici 7 (no se segur si esta be)
MATCH (h1:Habitatge{municipi:"SFLL"}), (h2:Habitatge{municipi:"SFLL"})
WHERE h1.carrer=h2.carrer AND h1.numero=h2.numero
RETURN h1.carrer, h1.numero, count(h1.carrer) as total_habs, collect(distinct(h1.any_padro)), collect(distinct(h1.id_llar)) order by total_habs desc limit 10

#Exercici 8 (no està bé)
MATCH(i:Individual)-[rel:FAMILIA]->(i2:Individual), (h:Habitatge{municipi:'CR'}) WITH collect(i.name) as persona, count(i2.name) as num_fills, i, h WHERE rel.relacio='hijo' AND num_fills>3 RETURN i.name, i.surname, i.second_surname, size(i2) ORDER BY size(i2) DESC, LIMIT(20)

# Exercici 9 (NO ACABADA)
MATCH (ind1:Individual)-[rel:FAMILIA]->(ind2:Individual), (p:Habitatge)
WHERE p.any_padro = 1881 AND p.municipi = 'SFLL' AND rel.relacio = 'fill'
RETURN count(distinct ind1) as `total_fills`, count(distinct p) as `num_llars`

# Exercici 10 (NIDEA)
MATCH (ind:Individual)-[:VIU]->(p:Habitatge)
WHERE p.municipi = 'SFLL' 
UNWIND p.any_padro AS any_padro
WITH DISTINCT any_padro, p.carrer as carrer
RETURN DISTINCT any_padro, carrer
